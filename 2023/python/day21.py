from collections import defaultdict

def solve1(s):
  s = s.strip().split("\n")
  n, m = len(s), len(s[0])
  si, sj = -1, -1
  for i in range(n):
    for j in range(n):
      if s[i][j] == 'S':
        si, sj = i, j
  di = [1, -1, 0, 0]
  dj = [0, 0, 1, -1]
  cur = set([(si, sj)])
  for iter in range(64):
    ncur = set()
    for (i, j) in cur:
      for d in range(4):
        ni, nj = i + di[d], j + dj[d]
        if 0 <= ni < n and 0 <= nj < m and s[ni][nj] != '#':
          ncur.add((ni, nj))
    cur = ncur
  print("Part 1:", len(cur))

def solve2(s):
  s = s.strip().split("\n")
  n, m = len(s), len(s[0])
  si, sj = -1, -1
  for i in range(n):
    for j in range(n):
      if s[i][j] == 'S':
        si, sj = i, j
  def good(i, j):
    i, j = i % n, j % m
    return s[i][j] != '#'
  def inside_plus(i, j):
    return True
    # inside_col = 0 <= j < m
    # inside_row = 0 <= i < n
    # return inside_col or inside_row


  di = [1, -1, 0, 0]
  dj = [0, 0, 1, -1]
  src = (si, sj)
  q = []
  vis = set()
  dist = {}

  q += [src]
  vis.add(src)
  dist[src] = 0
  DIST_BND = 1000
  
  while q:
    i, j = q[0]
    q = q[1:]
    dd = dist[(i, j)]
    for d in range(4):
      ni, nj = i + di[d], j + dj[d]
      if good(ni, nj) and (ni, nj) not in vis and inside_plus(ni, nj) and dd + 1 <= DIST_BND:
        q += [(ni, nj)]
        vis.add((ni, nj))
        dist[(ni, nj)] = dd + 1

  
  # t = 0
  # for i in range(n):
  #   for j in range(m):
      
  # t = 0
  # print("Part 2:", t)
def solve(s):
  solve1(s)
  solve2(s)

# solve("""
# ...........
# .....###.#.
# .###.##..#.
# ..#.#...#..
# ....#.#....
# .##..S####.
# .##..#...#.
# .......##..
# .##.#.####.
# .##..##.##.
# ...........  
# """)

solve("""
...................................................................................................................................
..............#............#..#......#.##.....#..##..##.#...............#.........#......#....#..#.......#............#.#..........
.......##.......#..#..................#.......#...#..##.##.................##......#.......#..#.....##........##..#.....#......###.
.......#...#..#...........#............#..#..........#.#..#................#.....#......#.................###.....#.#....#.........
...........#......#....#...#...#........#.............#....................#......#...............#..#..........#..............#...
...#.#..#.#............................#.....##........#........#..................#.#....##.............#.##...#......###.........
..#......#.........#...........#....#.....#..........#.................................#.................#............#..#......##.
.##...#...#....#................#.#.#.....#..................................................#...#.....#...#..#...............##...
.......#.............#.#..#........#.#...........#.#............#..#...........##.#....##...........#.........#..#.....#...........
......#......#...............#........#.....#...##.#...........................#....#..#.#......#....#.....#...#....#.........#....
..................##.#.......#.....#.......#......#...........#.#...............#.....#.##..#....#....#..............#.#..#...#....
...........#..........#......................#.............#...##......##...............#.......##.......#.......#..#....#.........
.....#..................#............#...#.......#...........#.......#................#..#...#....#.......##...#.....#........#....
...#...........#..............##...##.....#.#..#...............#....................#.......#..#..#.....#..#...#.............#..#..
.#......#.......................#......#.#..#.#...............#...............................#.#..#......#..........#....#....#...
..........#........#.........##.#...#.....................#.......#...#...............#...#..#......#..#.#........#...#...#........
.##.....#..#...............#............................#.............#..................#.....#...#.#....#......#.....#...........
....#...#..#.##.#........#..#.............................#..............#....#............#.....#.....#.#...#...#.......#....#.#..
......#.......#..#........#...........##............#.....##...##.............#........#....................#......#.......#.......
.#......#............#...#..#..#..##..................#...#...............#...............#.............#..#..#.##..#......#..#....
............#.............#...#.......#..........#....#..##....#...#...#.#.....#..............#...#....##..........................
...##...#.......#........#.#...#....#...#................................#.....#.#........#.......#.....#..........................
.#......#.......#...##.#..##.......#.......................#.#.....#.......................#.....#.......#.........#..........#.#..
.........#...........#...........................#.........##.......#......##..#............#..#.........#.......#....#............
......................#....##..................#.......#..........#..#...#.##.#.....................#.#...#....#.......#.......##..
..##.##...........#....#...#...#..#.#........##.....#.........#...#......#.#........#.............................#...#............
...........###...#..##.....#..................................#....##........#.#....#..............#...#..##.....#.....#......#..#.
....#....##.#........#.........##...............#............#....#..........#.....................#................#.#............
.#..##.#....#...............##.#.............#..#..............#......###.....#.#......................#.....##.........##.......#.
...#............#.......#..#...#...........#........#....#......#..............#.....................#..#..........................
.#...................#........#.........#.#.................#............#............#.#..................#...#....#....#.........
.......#..#........#..........#..........#.#.....#..##.........#..............#......#........................##.....#.#...........
............#.............................###........#.........#...#......#...#.#.....#...............#....##...#....##..##....#...
....#...#.##.......#.#..............##..................###..##......#........#.....#.#...................#...#......#........#..#.
..............##...#....##................###....###.#...#........#.....#..................#..............#...#.....#...#..........
..##......#.##......##....#........#...#..#...#............#...#....#..#.............#........#..................#........#........
..#....................#.#........#....#.....................#............#......#...#.....##.............#..........#..........#..
.........#...##..#........................#.##.....#...............#..##...#.....#..#............................#...#..##.#.....#.
.......................#........#.#.........#..#.......##..........................#..#.....#..................##..................
...............#...............#...#.........##......#.........#..#......#..#.........#....#...................#..#.#...###........
..#.#...#..#......##.......................#...#......#..............#......................#..#...............##..................
...........#.................#.....#..........##.........#..........#.....#............#....#.........................#.....#......
.........#..##....#..............#...#..........#......#..#.#.#..........#..#....#............##..#............#........#.#....#...
.....#.#..###....#.........#...#.....#........#..#.....##...#......#.................##...............#................#.....#.....
.......#....#..............#.#...#........#.....#...............#..#..#................#.........#...................##.....#......
......#...#.................#.#...........#.#.................................#.#.##.......#......#...#..#...................#.##..
..#...........#........#...#...#.....#...#.......#........##...#.......#...................................#..........#............
......#..#..#..........#..#...#......#..............#..#....#.....#.#....#........#.###.......#..#.#.....................#...#.....
..#..................#..#........#...#..........#..#.#....#...........#.#...#...#..#..#.#........#..#.......##...................#.
..#......##.............#.........#......#.##...##.#.#...#...........#.........#.##...#..#.....#...#....#..........................
................................##............#..#.............#...........#........#.##.......#.#...#..#...#.#........#.......#...
..........................#.........................#..........#....#.....#......#.#.......#.#..#.....#.....#..#.................#.
...#.............#...#...#...#...#.....#.........#.................#...##.....#......................#.....#.#.#.........##....#...
.....#...........#.##.#...#...#.#.#....#......#...#..#..#...#...#.#.#.#.##.......#.........#..........#...................#....##..
......#..................##..##.#.......#..............#.#...............#.#...#...##.......#.......#.....#....#...............#...
...#.........................#........##........#....#...#.....#....................#......#..#...........#.#.##..............#....
.............#........#....####..##..........#.#..............#...#............#.............##...####..........##...........##....
................#.....##..........#........#..##.#................#.......#.##....#.......#..#...##......##........................
.#.........#...#.......#.#.#....#.....#..................##.#.......#......#......#....#.......#...#.....#...#.....#...#.......#...
..........#...#..............#....#..#..#...............##.....#.......#...............#................#.#.#.#.........#..........
..............#.#...........#.......#............#..#..#.#..............#....#..##.#.#........#...#................#...#.#.........
.................................#............#...#................#...#......#.#...#..#............#............#.................
..............##....#........#............#.#...#.#....#...##..##........#.#.#....................#.#..........#.#....#....#.......
..........#.......#...#...#...#.#..#..#......#.......#..........#.........#..#.....................#........#....#..#.....#........
.....#....#........................#...#.#..#.....#...#.#.........#..........#.....#..#..#..###..#..............#..................
.................................................................S.................................................................
...............#................#.........#....#.#...........##.....#........................#.......#..#.#.....###..##.#..........
..........#....#........#...#..#.......#.#.........#.........#..#.....###......#.........#...#........#....#...#....##.............
.......##..............#........##.........#........#..#.#......#..........#........#....#............##.#........#....#..#........
.........##...........#....#.#.....#.........#.#....#.....##..#.....#.......#..#.#..................#.#......#.....................
..........##....##....#......##.......#...........#............#.......###.......##..#.#.#..#....#...#.........#.###.#.#...........
.................#.#..........#...#...#........#........#..###..............#....#............#.........#.......#.#....##..........
.##...............................#..#.#.......#...#....#...#............#......#........#....#.#....#..#.......#..#...............
................#..................#.......###..#..........#.#.................#..##......##.#........#......####..................
.....#...............................#..#.#.#....#.#............#....#....................##....#..............................#...
..#............#.#...#...........#.........#......#.................##.#...#.......................##..#...........................
................#......#....#...##..#........##..#.##..#.......#........#..........#................#..............................
.................................#..###..........#.....##............##.....##.......#.#.#....#..#.............#..#............#...
..#...#..............#............###...........#.#.#.#..#....#.#..#...#.....#..........................#....#...........#.#..#..#.
.#.###...#........#..............#.#........#.......#.......#.........#.....#...#..###...##..##..#....#.#......#.........#......#..
..........#.........#.......#..##.#.....#.##..#.........#..#...#.....#.#.##....#.........#.#.....#......#..............#...#.......
..#..#..#...#.........#..##...#..#...#......#.............#.#.........#.#...##.....#.....#...#..#.....#..##...........#........#...
..#....#....#................###...#......#.....#..#....#..........#.........#.#..#.................#.#..#............#.....##..#..
....#.......##........##...#..##........#........#..##............#.........#..##...#.....#..#...#.......#.............#........#..
.#...#...##.............#........##...#.....#.##....#...#.....#..........##..............#................................##.#.#...
.....#.......##.........#.....#.....#..#.###..#......#......##..............#................#..##..................##......###..#.
.##...####.......#..........#.........#...#........................##....#......#.......#........#.....#.........#..........#.#....
..................#...........#..#.....#..#........#...................#............#..........#..#.#...........#.#....#....#......
........#..#....................................#..................#.#................#..#....#.#.......................#....#.....
.#..............##..............##.##....##..##...#...##......##......#......#..........#....#..................................#..
.#....#.....#....##..............#.##..##...#.......#.##.......##..#.............#.#.....#...#......#............#..........##.....
..................##............#...##.................#...#.##...#.........#....#....#....#..#.....#........#..........#...#.#..#.
.##.......#........#.#.........#......................#.#..#.#........#.....................#.#.............###........#.#.........
.#..........#....#.....#...........#....#..........###................#.#.#...#.##......#...................#....#.....#.......#...
...#....#..#..#.......#.#..............#........#........###.#.....#....#...#.....##.......................#....#...........#....#.
..#.................................#.....###......#......##...#...#.......#............##.....#........#.#........................
.#...........#....#......#.......................#........##........#.........#.....#.....#....#............###..#...#.#....#......
.......#.#......#.#....................#.##................#.#...........#...........#.#...##........................#.............
....#......#....#.......#.....................#.#..#........#..........#..#..#.......#.#..............#......#..............#......
.....#......#.......#....................#.......#..#...####.##....#...#.#.......##...#.#...........#..............#..........#....
..#.........#........##....#.............##.#.#.........#....##........#..#........................#...#.#..#....#.................
.#....#..#.##.......#..#..#...##............##.##..#..#......#.##.......#.................#......................##.....#........#.
..................#.........#............#...##......................#...............#...........#................#.....#....#.#...
..#......##............#.......#.#................#.....#..........................#..#...................#....#....#.........#....
.#.#........#....#..##..#.....#.#...............#.......##..#.........#.....#........#...............##............................
..#.........##...................#.#........##......#.#.......##......##.#..#....#.#.#...........#..##...................#.......#.
....#.#.##.....###..#..........#....#..............#.###....#......##.............##...........#........#...........#...........##.
.#...##..#......##....#........##.#..............#.......##..#.....#....##.....................#...##..#............#..........#...
....#...#..........#...........#.#.#..............##.#.#.....###..................#.............#....#.....####....................
........#..#.........###........................#.#..#..........#.............................#...#......#.............##..........
.....#...#.............#.....#....#...#..............##.##........#..#...##.....#...............#..............#....#...#....#.....
....#.#...........#...#.##.....##....#.#...........##....#.....#...............................#.#.#...#.....#..#........#.........
...##...........................##..##.................##....#........#.....#...........#....#.....#............##.......#.........
............#.....#.....#......##...........................................#.........#.....#......#............#........#.#.#.....
......##...#....#...#...#.......#...........................#..#...#.#................#..........#...#.##..........#....##.#.......
.....#...#.#..###.#.#.........#.#..........#...........#.....#.............................#..#.#....#.#.....#.....#..#......#.....
.#.....#...#....................#...............................#.....#.............#.##.....####..##.....#.###....#..#............
....#...#.............#.#....#.....#..#..#...#.............#.......................#.#........#..#...#.................#...#.#...#.
..........#..#...#.....#..........#...#....#.#.....................#............................#....#.#......#.#.............#....
..##.....#...#......#.#....#....#.##.#....#......#........##........#...........#..#........#......#.#.....................#.#.....
......#...####.......#......#..##..###.......#...............#........#.........#....#.#.............##........##..#.#......#......
....##.##..........#.#.#.#.#..#.....##......................#.....#.#......................#....#.................#...........#....
.......#..##.#.#..##...#...........................#............................#....##.......#........#......#..........#.#.......
.....#.##.......#................#...#........#...#.............................#..#........#......###.###....#...##.............#.
.......#............##..........##..#.#.....#...................#................................#..#...#...#........#....#......#.
.#.#.#.#..#...#...........#.#.....#...................#.#......................#......##.....#..................#...##..#.#........
............#...............#...#........##....#..#...........................#.#..#.....#.##.................#...#....#......#....
.....#.......#.............................#......#..#.#..#.....................#...........#...#........#.#........#....#.........
.#.##..#............#..#.................................................#...#..###................##........##.#..#......#......#.
.........#...............##......#............#.....#...........................#.............##.#.#.#.......###.....#..........#..
...................................................................................................................................
""")
